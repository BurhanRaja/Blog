<!doctype html>
{% extends 'base.html' %}

{% block title %}Post{% endblock title %}

{% block body %}

{% load static %}
{% load extras %}

<link rel="stylesheet" href={% static 'css/post.css' %}>
<h1 class="post-title">{{post_list.title}}</h1>

<div class="cd-container">
  <div class="date-time">
    <p>{{post_list.created_on}}</p>
  </div>
</div>

<div class="post-container">

  <div class="post-image">
    <img src={{post_list.image.url}} class="img-fluid rounded" alt="...">
  </div>

  <div class="post-content">
    {{post_list.content}}
  </div>

</div>

<hr class="m-5">

<div class="comment-container">
  {% if user.is_authenticated %}
  <form action="/postcomment/" method="post" class="form-floating">
    {% csrf_token %}
    <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea2"
      style="height: 100px" name="commenttext"></textarea>
      <label for="floatingTextarea2">Add a Comment</label>
      <input type="hidden" name="postSno" value="{{post_list.sno}}" >
    <div class="submit-comment m-3">
      <button type="submit" class="btn btn-primary">Comment</button>
    </div>
</form>
{% else %}
<p style="text-align:center;"><strong style="color:red;">Please Log-in to make a comment</strong></p>
{% endif %}

  <div class="comment">
    <h3>Comments ({{comments.count}})</h3>
  </div>

  {% for comment in comments %}
  <div class="card w-75 card-user-comment">
    <div class="card-body">
      <strong class="card-title">{{comment.user}}</strong>
      <span class="comm-date">{{comment.timestamp|date:"M d, Y H:m"}}</span>
      <p class="card-text">{{comment.comment}}</p>

      {% comment %} Start {% endcomment %}
      <button class="btn m-2 reply-btn btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseView{{comment.sno}}"
        aria-expanded="false" aria-controls="collapseView{{comment.sno}}">
        View Replies
      </button>
      {% comment %} End {% endcomment %}


      {% comment %} Start {% endcomment %}
      <button class="btn m-2 reply-btn btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#replyBox{{comment.sno}}"
        aria-expanded="false" aria-controls="replyBox{{comment.sno}}">
        Reply
      </button>
      <div class="collapse" id="replyBox{{comment.sno}}">
        
        <form action="/postcomment/" method="post">
          {% csrf_token %}
          <div class="card card-body">
            <input type="text" class="form-control m-2" aria-label="Username" aria-describedby="addon-wrapping" name="commenttext" id="reply">
            <input type="hidden" name="parentSno" value="{{comment.sno}}">
            <div class="submit-reply m-3">
              <button class="btn btn-primary btn-sm" type="submit">Reply</button>
            </div>
          </div>
          <input type="hidden" name="postSno" value="{{post_list.sno}}" >
        </form>
      
      </div>
      {% comment %} End {% endcomment %}


      {% comment %} View Replies collapse (Start) {% endcomment %}
      <div class="collapse" id="collapseView{{comment.sno}}">
        <div class="card card-body">
          <p><strong class="usernameComm"></strong><span class="comm-date"></span></p>
          {% for reply in replyDict|get_val:comment.sno %}
          <p class="card-text">{{reply}}</p>
          {% endfor %}
        </div>
      </div>
      {% comment %} (End) {% endcomment %}

    </div>
  </div>
  {% endfor %}

</div>



{% endblock body %}
</body>

</html>